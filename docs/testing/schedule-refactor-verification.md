# 日程管理系统重构验证清单

## 数据库更新验证

### 1. 执行数据库更新脚本
- [ ] 在Supabase控制台执行 `scripts/schedule-system-update.sql`
- [ ] 验证所有新表创建成功
- [ ] 验证所有新字段添加成功
- [ ] 验证所有索引创建成功
- [ ] 验证RLS策略正确应用

### 2. 新表验证
- [ ] `task_templates` - 任务模板表
- [ ] `task_dependencies` - 任务依赖表
- [ ] `task_instances` - 任务实例表
- [ ] `automation_rules` - 自动化规则表
- [ ] `blog_templates` - 博客模板表
- [ ] `task_reminders` - 任务提醒表

### 3. 预设数据验证
- [ ] 系统任务模板已插入
- [ ] 博客模板已插入
- [ ] 数据格式正确

## API接口验证

### 1. 任务模板API
- [ ] GET /api/templates - 获取模板列表
- [ ] POST /api/templates - 创建模板
- [ ] POST /api/templates/[id]/apply - 应用模板
- [ ] GET /api/templates/[id]/preview - 预览模板

### 2. 重复任务API
- [ ] POST /api/tasks/recurring - 生成重复任务实例
- [ ] GET /api/tasks/recurring/instances/[taskId] - 获取任务实例

### 3. 自动化规则API
- [ ] GET /api/automation/rules - 获取规则列表
- [ ] POST /api/automation/rules - 创建规则
- [ ] PUT /api/automation/rules/[id] - 更新规则
- [ ] DELETE /api/automation/rules/[id] - 删除规则

### 4. 博客生成API
- [ ] POST /api/blog/generate - 生成博客
- [ ] POST /api/blog/preview - 预览博客
- [ ] GET /api/blog/templates - 获取博客模板
- [ ] POST /api/blog/templates - 创建博客模板

## 功能验证

### 1. 重复任务功能
- [ ] 创建每日重复任务
- [ ] 创建每周重复任务（可选择星期几）
- [ ] 创建每月重复任务
- [ ] 设置结束日期
- [ ] 设置最大重复次数
- [ ] 查看任务实例列表
- [ ] 暂停/恢复重复任务
- [ ] 跳过实例

### 2. 任务模板功能
- [ ] 使用系统预设模板
- [ ] 创建自定义模板
- [ ] 从现有任务创建模板
- [ ] 预览模板应用结果
- [ ] 应用模板创建任务
- [ ] 查看模板使用统计

### 3. 自动化规则功能
- [ ] 创建任务状态变更触发器
- [ ] 创建时间触发器
- [ ] 设置通知动作
- [ ] 设置创建后续任务动作
- [ ] 启用/禁用规则
- [ ] 手动执行规则
- [ ] 查看执行历史

### 4. 博客生成功能
- [ ] 从总结生成博客
- [ ] 选择不同博客模板
- [ ] 预览博客内容
- [ ] 自动生成标签
- [ ] 定时发布博客
- [ ] AI洞察生成（如配置）

## UI组件验证

### 1. 模板选择器
- [ ] 模板列表显示
- [ ] 模板搜索和筛选
- [ ] 模板详情查看
- [ ] 模板预览功能
- [ ] 应用模板确认

### 2. 自动化规则管理界面
- [ ] 规则列表显示
- [ ] 规则创建表单
- [ ] 规则启用/禁用
- [ ] 规则删除确认

### 3. 任务表单增强
- [ ] 重复任务设置界面
- [ ] 重复模式选择
- [ ] 重复预览显示

## 定时任务验证

### 1. 手动执行测试
```bash
# 安装tsx（如果未安装）
npm install -g tsx

# 执行定时任务
npm run scheduled-tasks
```

- [ ] 重复任务实例生成
- [ ] 自动化规则处理
- [ ] 博客草稿生成
- [ ] 定时博客发布
- [ ] 数据清理执行

### 2. 日志验证
- [ ] 检查控制台输出
- [ ] 验证各步骤执行成功
- [ ] 检查错误处理

## 性能测试

### 1. 数据库查询
- [ ] 模板列表查询 < 100ms
- [ ] 任务实例查询 < 200ms
- [ ] 自动化规则查询 < 100ms

### 2. API响应
- [ ] 模板API < 500ms
- [ ] 重复任务API < 1000ms
- [ ] 博客生成API < 2000ms

### 3. 前端渲染
- [ ] 模板选择器加载 < 1s
- [ ] 自动化规则页面加载 < 1s
- [ ] 任务表单响应 < 500ms

## 安全验证

### 1. 权限控制
- [ ] 用户只能访问自己的模板
- [ ] 用户只能管理自己的规则
- [ ] RLS策略正确应用

### 2. 输入验证
- [ ] 表单数据验证
- [ ] API参数验证
- [ ] SQL注入防护

## 集成测试

### 1. 端到端流程
```
创建模板 → 应用模板 → 生成重复任务 → 任务完成 → 自动生成总结 → 生成博客
```

### 2. 数据一致性
- [ ] 任务实例正确生成
- [ ] 模板使用次数更新
- [ ] 自动化规则执行计数
- [ ] 博客关联总结

## 部署验证

### 1. 生产环境配置
- [ ] 环境变量设置
- [ ] 数据库迁移执行
- [ ] 定时任务配置
- [ ] 监控设置

### 2. 回滚计划
- [ ] 数据库备份
- [ ] 代码回滚策略
- [ ] 用户通知方案

## 已知问题

### 1. 待解决问题
- [ ] 任务依赖管理界面
- [ ] 提醒功能实现
- [ ] 邮件服务集成

### 2. 优化空间
- [ ] 大数据量分页优化
- [ ] 缓存策略实现
- [ ] 移动端体验优化

## 验证完成确认

- [ ] 所有新功能测试通过
- [ ] 性能指标达标
- [ ] 安全检查通过
- [ ] 文档更新完成
- [ ] 部署准备就绪

## 测试负责人签名

_________________________
日期：_________________

## 备注

请确保在部署到生产环境前完成所有验证项目。如有任何问题，请及时反馈。